title: Heat Pump
views:
  # 1) YLEISKUVA
  - title: "Yleiskuva"
    path: overview
    icon: mdi:heat-pump
    cards:
      - type: entities
        title: "Hetkellinen"
        show_header_toggle: false
        entities:
          - entity: sensor.techroom_esp32_heat_pump_power
            name: "Ottoteho (kW)"
          - entity: sensor.techroom_esp32_hp_lampoteho
            name: "Lämpöteho (kW)"
          - entity: sensor.techroom_esp32_hp_pulse_rate
            name: "Pulssit (imp/min)"
          - entity: sensor.techroom_esp32_hp_delta_t
            name: "Latauspiiri ΔT (°C)"
          - entity: sensor.techroom_esp32_hp_brine_delta_t
            name: "Maaliuos ΔT (°C)"
          - entity: sensor.techroom_esp32_heat_pump_cop
            name: "COP (Hetkellinen)"
          - entity: sensor.heatpump_scop_instant
            name: "SCOP (System)"

      - type: entities
        title: "Varaaja (kerrokset)"
        show_header_toggle: false
        entities:
          - entity: sensor.techroom_esp32_varaaja_yla
            name: "Varaaja Ylä"
          - entity: sensor.techroom_esp32_varaaja_keski_yla
            name: "Varaaja Keski-Ylä"
          - entity: sensor.techroom_esp32_varaaja_keski_ala
            name: "Varaaja Keski-Ala"
          - entity: sensor.techroom_esp32_varaaja_ala
            name: "Varaaja Ala"
          - entity: sensor.heatpump_tank_average
            name: "Varaajan Keskiarvo"
          - entity: sensor.heatpump_tank_energy_kwh
            name: "Varaajan Energia (kWh)"
          - entity: sensor.tank_energy_change_kw
            name: "Energian muutosnopeus (kW)"

      - type: entities
        title: "Käynnit & analytiikka"
        show_header_toggle: false
        entities:
          - entity: binary_sensor.techroom_esp32_heat_pump_running
            name: "Pumppu käynnissä"
          - entity: sensor.heatpump_last_run_time
            name: "Edellinen käynti (min)"
          - entity: sensor.heatpump_start_count
            name: "Käynnistykset (tänään)"
          - entity: sensor.heatpump_avg_run_time
            name: "Keskikäyntiaika (min)"

  # 2) ENERGIA
  - title: "Energia"
    path: energy
    icon: mdi:flash
    cards:
      - type: statistics-graph
        title: "Sähkö (kWh/pv) – viimeiset 7 päivää"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_energy_daily
            name: "Sähkö (kWh/pv)"

      - type: statistics-graph
        title: "Lämpö (kWh/pv) – viimeiset 7 päivää"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_heat_daily
            name: "Lämpö (kWh/pv)"

      - type: statistics-graph
        title: "UFH märkätilat (kWh/pv) – 7 pv"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_ufh_wet_energy_daily
            name: "UFH Märkätilat"

      - type: statistics-graph
        title: "UFH muut tilat (kWh/pv) – 7 pv"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_ufh_main_energy_daily
            name: "UFH Muut tilat"

      - type: entities
        title: "Utility-mittarit"
        show_header_toggle: false
        entities:
          - entity: sensor.heatpump_energy_daily
            name: "Sähkö Tänään"
          - entity: sensor.heatpump_energy_monthly
            name: "Sähkö Kuukausi"
          - entity: sensor.heatpump_heat_daily
            name: "Lämpö Tänään"
          - entity: sensor.heatpump_heat_monthly
            name: "Lämpö Kuukausi"
          - entity: sensor.heatpump_ufh_wet_energy_daily
            name: "UFH Märkätilat Tänään"
          - entity: sensor.heatpump_ufh_main_energy_daily
            name: "UFH Muut tilat Tänään"

      - type: entities
        title: "SCOP-aggregaatit"
        show_header_toggle: false
        entities:
          - entity: sensor.heatpump_scop_daily
          - entity: sensor.heatpump_scop_monthly

  # 3) LÄMPÖTILAT
  - title: "Lämpötilat"
    path: temps
    icon: mdi:thermometer
    cards:
      - type: history-graph
        title: "dT – lataus vs liuos (24 h)"
        hours_to_show: 24
        refresh_interval: 60
        entities:
          - entity: sensor.techroom_esp32_hp_delta_t
            name: "Lataus ΔT"
          - entity: sensor.techroom_esp32_hp_brine_delta_t
            name: "Liuos ΔT"

      - type: history-graph
        title: "Varaaja – kerrokset (24 h)"
        hours_to_show: 24
        refresh_interval: 60
        entities:
          - entity: sensor.techroom_esp32_varaaja_yla
          - entity: sensor.techroom_esp32_varaaja_keski_yla
          - entity: sensor.techroom_esp32_varaaja_keski_ala
          - entity: sensor.techroom_esp32_varaaja_ala

      - type: entities
        title: "Kosteat tilat – lattialämmitys"
        show_header_toggle: false
        entities:
          - entity: input_number.hp_kosteat_virtaus
            name: "Asetus: Virtaus (m³/h)"
          - entity: sensor.techroom_esp32_ll_kosteat_tilat_meno
            name: "Meno (°C)"
          - entity: sensor.techroom_esp32_ll_kosteat_tilat_paluu
            name: "Paluu (°C)"
          - entity: sensor.heatpump_ufh_wet_delta_t
            name: "Delta T (°C)"
          - entity: sensor.heatpump_ufh_wet_power
            name: "Hetkellinen teho (kW)"

      - type: entities
        title: "Muut tilat – lattialämmitys"
        show_header_toggle: false
        entities:
          - entity: input_number.hp_ufh_main_flow
            name: "Asetus: Virtaus (m³/h)"
          - entity: sensor.techroom_esp32_ufh_muut_tilat_meno
            name: "Meno (°C)"
          - entity: sensor.techroom_esp32_ufh_muut_tilat_paluu
            name: "Paluu (°C)"
          - entity: sensor.heatpump_ufh_main_delta_t
            name: "Delta T (°C)"
          - entity: sensor.heatpump_ufh_main_power
            name: "Hetkellinen teho (kW)"

      - type: history-graph
        title: "UFH Lämpötilat (24 h)"
        hours_to_show: 24
        refresh_interval: 60
        entities:
          - entity: sensor.techroom_esp32_ll_kosteat_tilat_meno
            name: "Märkätilat Meno"
          - entity: sensor.techroom_esp32_ufh_muut_tilat_meno
            name: "Muut tilat Meno"
          - entity: sensor.outdoor_temperature
            name: "Ulkolämpötila"

      - type: statistics-graph
        title: "Kosteat tilat – Teho / Ulkolämpö"
        chart_type: line
        days_to_show: 3
        stat_types: [mean]
        entities:
          - entity: sensor.heatpump_ufh_wet_power
            name: "Teho vs Ulkolämpö"

  # 4) OLOSUHTEET
  - title: "Olosuhteet"
    path: environment
    icon: mdi:home-thermometer
    cards:
      - type: entities
        title: "Tekniikkatila (Tech Room)"
        show_header_toggle: false
        entities:
          - entity: sensor.techroom_esp32_tech_room_temperature
            name: "Tech Room Temperature (°C)"
          - entity: sensor.techroom_esp32_tech_room_humidity
            name: "Tech Room Humidity (%)"
          - entity: sensor.techroom_esp32_heatpump_rssi
            name: "ESP32 RSSI (dBm)"

      - type: history-graph
        title: "Tech Room – lämpötila & kosteus (24 h)"
        hours_to_show: 24
        refresh_interval: 60
        entities:
          - entity: sensor.techroom_esp32_tech_room_temperature
          - entity: sensor.techroom_esp32_tech_room_humidity

      - type: entities
        title: "Brine mittaukset"
        show_header_toggle: false
        entities:
          - entity: sensor.techroom_esp32_hp_liuos_meno
            name: "Brine menosisään (°C)"
          - entity: sensor.techroom_esp32_hp_liuos_paluu
            name: "Brine paluu (°C)"
          - entity: sensor.techroom_esp32_hp_brine_delta_t
            name: "Brine Delta T"

      - type: history-graph
        title: "Brine – meno/paluu (24 h)"
        hours_to_show: 24
        refresh_interval: 60
        entities:
          - entity: sensor.techroom_esp32_hp_liuos_meno
          - entity: sensor.techroom_esp32_hp_liuos_paluu
          - entity: sensor.techroom_esp32_hp_brine_delta_t

  # 5) ANALYTIIKKA
  - title: "Analytiikka"
    path: analytics
    icon: mdi:chart-areaspline
    cards:
      - type: history-graph
        title: "COP vs Brine In (24 h)"
        hours_to_show: 24
        refresh_interval: 60
        entities:
          - entity: sensor.techroom_esp32_heat_pump_cop
            name: "COP"
          - entity: sensor.techroom_esp32_hp_liuos_meno
            name: "Brine In (°C)"

      - type: statistics-graph
        title: "COP & Brine In – päiväkeskiarvot (30 vrk)"
        days_to_show: 30
        period: day
        stat_types: [ mean ]
        entities:
          - entity: sensor.techroom_esp32_heat_pump_cop
            name: "COP (ka)"
          - entity: sensor.techroom_esp32_hp_liuos_meno
            name: "Brine In (ka)"

      - type: history-graph
        title: "Tehot: P_el vs P_th vs UFH total (24 h)"
        hours_to_show: 24
        refresh_interval: 60
        entities:
          - entity: sensor.techroom_esp32_heat_pump_power
            name: "P_el (kW)"
          - entity: sensor.techroom_esp32_hp_lampoteho
            name: "P_th (kW)"
          - entity: sensor.tank_energy_change_kw
            name: "dE_tank/dt (kW)"

  # 6) MITTARIT (gauge)
  - title: "Mittarit"
    path: gauges
    icon: mdi:gauge
    cards:
      - type: gauge
        name: "COP (hetkellinen)"
        entity: sensor.techroom_esp32_heat_pump_cop
        min: 0
        max: 8
        severity: { green: 3, yellow: 2, red: 0 }

      - type: gauge
        name: "UFH märkätilat teho (kW)"
        entity: sensor.heatpump_ufh_wet_power
        min: 0
        max: 3
        severity: { green: 1.6, yellow: 0.5, red: 0 }

      - type: gauge
        name: "UFH muut tilat teho (kW)"
        entity: sensor.heatpump_ufh_main_power
        min: 0
        max: 4
        severity: { green: 2.0, yellow: 0.5, red: 0 }

      - type: gauge
        name: "Ottoteho P_el (kW)"
        entity: sensor.techroom_esp32_heat_pump_power
        min: 0
        max: 4
        severity: { green: 2.5, yellow: 1.0, red: 0 }

      - type: gauge
        name: "Lämpöteho P_th (kW)"
        entity: sensor.techroom_esp32_hp_lampoteho
        min: 0
        max: 12
        severity: { green: 6, yellow: 3, red: 0 }

  # 7) ASETUKSET
  - title: "Asetukset"
    path: settings
    icon: mdi:tune
    cards:
      - type: entities
        title: "Varaajan parametrit"
        show_header_toggle: false
        entities:
          - entity: input_number.tank_volume_l
            name: "Varaajan tilavuus (L)"
          - entity: input_number.tank_loss_w_per_k
            name: "Varaajan häviökerroin (W/K)"
          - entity: input_number.tank_energy_ref_c
            name: "Tank Energy – referenssi (°C)"

      - type: entities
        title: "UFH virtausasetukset"
        show_header_toggle: false
        entities:
          - entity: input_number.hp_kosteat_virtaus
            name: "LL kosteat tilat virtaus (m³/h)"
          - entity: input_number.hp_ufh_main_flow
            name: "LL muut tilat virtaus (m³/h)"

      - type: entities
        title: "Anturivalinta ja Aikaohjaus"
        show_header_toggle: false
        entities:
          - entity: switch.techroom_esp32_anturi_2_kaytossa
            name: "Anturi 2 käytössä (ESPHome)"
          - type: section
            label: "Aikaohjaus (Placeholder)"
          # Lisää tähän input_datetime entityt jos ne on luotu

      - type: entities
        title: "Debug / Diagnostiikka"
        show_header_toggle: false
        entities:
          - entity: sensor.techroom_esp32_heatpump_rssi
          - entity: sensor.techroom_esp32_heatpump_uptime

  # 8) HÄLYTYKSET
  - title: "Hälytykset"
    path: alerts
    icon: mdi:alert-decagram
    cards:
      - type: entities
        title: "Asetukset"
        show_header_toggle: false
        entities:
          - entity: input_number.hp_min_cop_limit
            name: "COP minimi"
          - entity: input_number.hp_brine_dt_limit
            name: "Brine ΔT max (°C)"

      - type: entity-filter
        card:
          type: entities
          title: "Aktiiviset hälytykset"
          state_color: true
          show_empty: false
        entities:
          - binary_sensor.hp_alert_cop_low
          - binary_sensor.hp_alert_brine_dt_high
        state_filter: [ "on" ]

      - type: logbook
        title: "Hälytyshistoria (7 vrk)"
        hours_to_show: 168
        entities:
          - binary_sensor.hp_alert_cop_low
          - binary_sensor.hp_alert_brine_dt_high