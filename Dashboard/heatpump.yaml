title: Heat Pump
views:
  # 1) YLEISKUVA testi
  - title: "Yleiskuva"
    path: overview
    icon: mdi:heat-pump
    cards:
      - type: entities
        title: "Hetkellinen"
        show_header_toggle: false
        entities:
          - entity: sensor.heatpump_power_display_ui
            name: "Heatpump Power (kW)"
          - entity: sensor.heatpump_heat_power
            name: "Heatpump Heat Power (kW)"
          - entity: sensor.hp_pulse_rate_alias
            name: "HP Pulse Rate (imp/min)"
          - entity: sensor.heatpump_delta_t
            name: "Heatpump Delta T (°C)"
          - entity: sensor.heatpump_brine_delta_t_display
            name: "Heatpump Brine Delta T (°C)"
          - entity: sensor.heatpump_cop_display
            name: "Heatpump COP (display)"
          - entity: sensor.heatpump_scop_instant
            name: "Heatpump SCOP (instant)"

      - type: entities
        title: "Varaaja (kerrokset)"
        show_header_toggle: false
        entities:
          - entity: sensor.heatpump_tank_top
            name: "Heatpump Tank Top"
          - entity: sensor.heatpump_tank_mid_top
            name: "Heatpump Tank Mid Top"
          - entity: sensor.heatpump_tank_mid_bottom
            name: "Heatpump Tank Mid Bottom"
          - entity: sensor.heatpump_tank_bottom
            name: "Heatpump Tank Bottom"
          - entity: sensor.heatpump_tank_average
            name: "Heatpump Tank Average"
          - entity: sensor.heatpump_tank_energy_kwh_v2
            name: "Tank Energy (kWh)"
          - entity: sensor.tank_energy_change_kw_v4
            name: "Tank Energy Change (kW)"

      - type: entities
        title: "Käynnit & analytiikka"
        show_header_toggle: false
        entities:
          - entity: binary_sensor.heatpump_running
            name: "Heatpump Running"
          - entity: sensor.heatpump_last_run_time_min_v3
            name: "Heatpump Last Run Time (min)"
          - entity: sensor.heatpump_last_off_time_min_v3
            name: "Heatpump Last Off Time (min)"
          - entity: sensor.heatpump_start_count_v2
            name: "Heatpump Start Count (today)"
          - entity: sensor.heatpump_avg_run_time_v2
            name: "Heatpump Avg Run Time (today, min)"

  # 2) ENERGIA
  - title: "Energia"
    path: energy
    icon: mdi:flash
    cards:
      - type: statistics-graph
        title: "Sähkö (kWh/pv) – viimeiset 7 päivää"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_electrical_energy_total_lts_v2
            name: "Sähkö (kWh/pv)"

      - type: statistics-graph
        title: "Lämpö (kWh/pv) – viimeiset 7 päivää"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_heat_energy_total_lts_v2
            name: "Lämpö (kWh/pv)"

      - type: statistics-graph
        title: "UFH märkätilat (kWh/pv) – viimeiset 7 päivää"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_ufh_wet_energy_total_lts_v2
            name: "UFH märkätilat (kWh/pv)"

      - type: statistics-graph
        title: "UFH muut tilat (kWh/pv) – viimeiset 7 päivää"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_ufh_main_energy_total_lts_v2
            name: "UFH muut tilat (kWh/pv)"

      - type: statistics-graph
        title: "UFH yhteensä (kWh/pv) – viimeiset 7 päivää"
        chart_type: bar
        days_to_show: 7
        period: day
        stat_types: [ change ]
        entities:
          - entity: sensor.heatpump_ufh_total_energy_total_lts_v2
            name: "UFH yhteensä (kWh/pv)"

      - type: entities
        title: "Utility-mittarit (päivä/vko/kk/vuosi)"
        show_header_toggle: false
        entities:
          - entity: sensor.heatpump_electricity_daily
          - entity: sensor.heatpump_electricity_weekly
          - entity: sensor.heatpump_electricity_monthly
          - entity: sensor.heatpump_electricity_yearly
          - entity: sensor.heatpump_heat_daily
          - entity: sensor.heatpump_heat_weekly
          - entity: sensor.heatpump_heat_monthly
          - entity: sensor.heatpump_heat_yearly
          - entity: sensor.heatpump_ufh_wet_daily_v2
            name: "UFH märkätilat – päivä (kWh)"
          - entity: sensor.heatpump_ufh_main_daily_v2
            name: "UFH muut tilat – päivä (kWh)"
          - entity: sensor.heatpump_ufh_total_daily_v2
            name: "UFH yhteensä – päivä (kWh)"

      - type: entities
        title: "SCOP-aggregaatit"
        show_header_toggle: false
        entities:
          - entity: sensor.heatpump_scop_daily
          - entity: sensor.heatpump_scop_monthly

  # 3) LÄMPÖTILAT
  - title: "Lämpötilat"
    path: temps
    icon: mdi:thermometer
    cards:
      - type: history-graph
        title: "dT – lataus vs liuos (24 h)"
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.heatpump_delta_t
            name: "Heatpump Delta T"
          - entity: sensor.heatpump_brine_delta_t_display
            name: "Heatpump Brine Delta T"

      - type: history-graph
        title: "Varaaja – kerrokset (24 h)"
        hours_to__show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.heatpump_tank_top
          - entity: sensor.heatpump_tank_mid_top
          - entity: sensor.heatpump_tank_mid_bottom
          - entity: sensor.heatpump_tank_bottom
          - entity: sensor.heatpump_tank_average

      - type: entities
        title: "Kosteat tilat – lattialämmitys"
        show_header_toggle: false
        entities:
          - entity: input_number.hp_kosteat_virtaus
            name: "Virtaus (m³/h)"
          - entity: sensor.heatpump_ufh_wet_supply_v2
            name: "Meno (°C)"
          - entity: sensor.heatpump_ufh_wet_return_v2
            name: "Paluu (°C)"
          - entity: sensor.heatpump_ufh_wet_delta_t_v2
            name: "Delta T (°C)"
          - entity: sensor.heatpump_ufh_wet_heat_power_v2
            name: "Hetkellinen teho (kW)"

      - type: entities
        title: "Muut tilat – lattialämmitys"
        show_header_toggle: false
        entities:
          - entity: input_number.hp_ufh_main_flow
            name: "Virtaus (m³/h)"
          - entity: sensor.heatpump_ufh_main_supply_v2
            name: "Meno (°C)"
          - entity: sensor.heatpump_ufh_main_return_v2
            name: "Paluu (°C)"
          - entity: sensor.heatpump_ufh_main_delta_t_v2
            name: "Delta T (°C)"
          - entity: sensor.heatpump_ufh_main_heat_power_v2
            name: "Hetkellinen teho (kW)"

      - type: history-graph
        title: "UFH tehot (24 h)"
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.heatpump_ufh_wet_heat_power_v2
            name: "UFH märkätilat (kW)"
          - entity: sensor.heatpump_ufh_main_heat_power_v2
            name: "UFH muut tilat (kW)"
          - entity: sensor.heatpump_ufh_total_heat_power_v2
            name: "UFH yhteensä (kW)"
          - entity: sensor.outdoor_temperature_2
            name: "Ulkolämpötila (°C)"

      - type: statistics-graph
        title: "Kosteat tilat – Teho / Ulkolämpö (suhdeluku)"
        chart_type: line
        days_to_show: 3
        stat_types: [mean, min, max]
        entities:
          - entity: sensor.ufh_wet_heat_vs_outdoor
            name: "Teho suhteessa ulkolämpötilaan"

  # 4) OLOSUHTEET
  - title: "Olosuhteet"
    path: environment
    icon: mdi:home-thermometer
    cards:
      - type: entities
        title: "Tekniikkatila (Tech Room)"
        show_header_toggle: false
        entities:
          - entity: sensor.heatpump_room_temperature_v2
            name: "Tech Room Temperature (°C)"
          - entity: sensor.heatpump_room_humidity_v2
            name: "Tech Room Humidity (%)"
          - entity: sensor.heatpump_rssi_v2
            name: "ESP32 RSSI (dBm)"

      - type: history-graph
        title: "Tech Room – lämpötila & kosteus (24 h)"
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.heatpump_room_temperature_v2
          - entity: sensor.heatpump_room_humidity_v2

      - type: entities
        title: "Brine mittaukset"
        show_header_toggle: false
        entities:
          - entity: sensor.techroom_esp32_hp_liuos_meno
            name: "Brine menosisään (°C)"
          - entity: sensor.techroom_esp32_hp_liuos_paluu
            name: "Brine paluu (°C)"
          - entity: sensor.heatpump_brine_power
            name: "Brine Power (kW)"

      - type: history-graph
        title: "Brine – meno/paluu/teho (24 h)"
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.techroom_esp32_hp_liuos_meno
          - entity: sensor.techroom_esp32_hp_liuos_paluu
          - entity: sensor.heatpump_brine_power

  # 5) ANALYTIIKKA
  - title: "Analytiikka"
    path: analytics
    icon: mdi:chart-areaspline
    cards:
      - type: history-graph
        title: "COP vs Brine In (24 h)"
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.heatpump_cop_gauge
            name: "COP"
          - entity: sensor.techroom_esp32_hp_liuos_meno
            name: "Brine In (°C)"

      - type: statistics-graph
        title: "COP & Brine In – päiväkeskiarvot (30 vrk)"
        days_to_show: 30
        period: day
        stat_types: [ mean ]
        entities:
          - entity: sensor.heatpump_cop_gauge
            name: "COP (ka)"
          - entity: sensor.techroom_esp32_hp_liuos_meno
            name: "Brine In (ka)"

      - type: history-graph
        title: "Tehot: P_el vs P_th vs UFH total vs dE/dt (24 h)"
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.heatpump_power_display_ui
            name: "P_el (kW)"
          - entity: sensor.heatpump_heat_power
            name: "P_th (kW)"
          - entity: sensor.heatpump_ufh_total_heat_power_v2
            name: "UFH total (kW)"
          - entity: sensor.tank_energy_change_kw_v4
            name: "dE_tank/dt (kW)"

      - type: history-graph
        title: "Ottoteho – suodatinvertailu (24 h)"
        hours_to_show: 24
        refresh_interval: 30
        entities:
          - entity: sensor.heatpump_power_display
          - entity: sensor.heatpump_power_display_tc15
          - entity: sensor.heatpump_power_display_tc30

  # 6) MITTARIT (gauge)
  - title: "Mittarit"
    path: gauges
    icon: mdi:gauge
    cards:
      - type: gauge
        name: "COP (hetkellinen)"
        entity: sensor.heatpump_cop_gauge
        min: 0
        max: 8
        severity: { green: 3, yellow: 2, red: 0 }

      - type: gauge
        name: "SCOP (instant)"
        entity: sensor.heatpump_scop_instant
        min: 0
        max: 8
        severity: { green: 3, yellow: 2, red: 0 }

      - type: gauge
        name: "UFH märkätilat teho (kW)"
        entity: sensor.heatpump_ufh_wet_heat_power_v2
        min: 0
        max: 3
        severity: { green: 1.6, yellow: 0.5, red: 0 }

      - type: gauge
        name: "UFH muut tilat teho (kW)"
        entity: sensor.heatpump_ufh_main_heat_power_v2
        min: 0
        max: 4
        severity: { green: 2.0, yellow: 0.5, red: 0 }

      - type: gauge
        name: "UFH yhteensä teho (kW)"
        entity: sensor.heatpump_ufh_total_heat_power_v2
        min: 0
        max: 6
        severity: { green: 3.5, yellow: 1.0, red: 0 }

      - type: gauge
        name: "Ottoteho P_el (kW)"
        entity: sensor.heatpump_power_display_ui
        min: 0
        max: 4
        severity: { green: 2.5, yellow: 1.0, red: 0 }

      - type: gauge
        name: "Lämpöteho P_th (kW)"
        entity: sensor.heatpump_heat_power
        min: 0
        max: 12
        severity: { green: 6, yellow: 3, red: 0 }

  # 7) ASETUKSET
  - title: "Asetukset"
    path: settings
    icon: mdi:tune
    cards:
      - type: entities
        title: "Varaajan parametrit"
        show_header_toggle: false
        entities:
          - entity: input_number.tank_volume_l
            name: "Varaajan tilavuus (L)"
          - entity: input_number.tank_loss_w_per_k
            name: "Varaajan häviökerroin (W/K)"
          - entity: input_number.tank_energy_ref_c
            name: "Tank Energy – referenssi (°C)"

      - type: entities
        title: "UFH virtausasetukset"
        show_header_toggle: false
        entities:
          - entity: input_number.hp_kosteat_virtaus
            name: "LL kosteat tilat virtaus (m³/h)"
          - entity: input_number.hp_ufh_main_flow
            name: "LL muut tilat virtaus (m³/h)"

      - type: entities
        title: "Anturivalinnan aikaohjaus"
        show_header_toggle: false
        entities:
          - entity: input_select.hp_sensor_mode
            name: "Tila (On/Auto/Off)"
          - entity: switch.anturi_2_kaytossa
            name: "Anturi 2 käytössä (ESPHome)"
          - type: divider
          - entity: input_datetime.hp_sched_start_time
            name: "Aikaohjaus alkaa"
          - entity: input_datetime.hp_sched_end_time
            name: "Aikaohjaus päättyy"
          - type: section
            label: "Aktiiviset viikonpäivät"
          - entity: input_boolean.hp_sched_mon
            name: "Ma"
          - entity: input_boolean.hp_sched_tue
            name: "Ti"
          - entity: input_boolean.hp_sched_wed
            name: "Ke"
          - entity: input_boolean.hp_sched_thu
            name: "To"
          - entity: input_boolean.hp_sched_fri
            name: "Pe"
          - entity: input_boolean.hp_sched_sat
            name: "La"
          - entity: input_boolean.hp_sched_sun
            name: "Su"

      - type: entities
        title: "Tank-mittarit (debug)"
        show_header_toggle: false
        entities:
          - entity: sensor.tankavg_dtdt_kph
            name: "TankAvg dT/dt (K/h)"
          - entity: sensor.tankavg_dtdt_kph_sma10
            name: "TankAvg dT/dt SMA10 (K/h)"
          - entity: sensor.tank_energy_change_kw_v4
            name: "Tank Energy Change (kW) v4"

  # 8) HÄLYTYKSET
  - title: "Hälytykset"
    path: alerts
    icon: mdi:alert-decagram
    cards:
      - type: entities
        title: "Asetukset"
        show_header_toggle: false
        entities:
          - entity: input_number.ufh_vs_tank_margin_c
            name: "UFH vs TankTop marginaali (°C)"
          - entity: input_number.hp_cold_tank_limit_c
            name: "Pitkä OFF → TankTop 'kylmä' raja (°C)"
          - entity: input_number.hp_min_cop_limit
            name: "COP minimi"
          - entity: input_number.hp_brine_dt_limit
            name: "Brine ΔT max (°C)"
          - entity: input_number.hp_ufh_dt_min_wet
            name: "UFH ΔT min (märkätilat)"
          - entity: input_number.hp_ufh_dt_min_main
            name: "UFH ΔT min (muu talo)"

      - type: entity-filter
        card:
          type: entities
          title: "Aktiiviset hälytykset (tila)"
          state_color: true
          show_empty: false
        entities:
          - binary_sensor.hp_alert_ufh_supply_ge_tanktop
          - binary_sensor.hp_alert_long_off_cold
          - binary_sensor.hp_alert_cop_low
          - binary_sensor.hp_alert_brine_dt_high
          - binary_sensor.hp_alert_ufh_dt_low_wet
          - binary_sensor.hp_alert_ufh_dt_low_main
        state_filter: [ "on" ]

      - type: logbook
        title: "Hälytyshistoria (7 vrk)"
        hours_to_show: 168
        entities:
          - binary_sensor.hp_alert_ufh_supply_ge_tanktop
          - binary_sensor.hp_alert_long_off_cold
          - binary_sensor.hp_alert_cop_low
          - binary_sensor.hp_alert_brine_dt_high
          - binary_sensor.hp_alert_ufh_dt_low_wet
          - binary_sensor.hp_alert_ufh_dt_low_main