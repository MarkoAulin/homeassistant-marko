# Fallback: julkaise kanoniset LTS-aliaset myös perinteisenä template-sensorina.
# Jos trigger-template jo toimii, nämä ovat identtiset eikä haittaa.

template:
  - sensor:
      - name: "Heatpump Electrical Energy Total LTS"
        unique_id: heatpump_electrical_energy_total_lts_alias_fallback
        unit_of_measurement: "kWh"
        device_class: energy
        state_class: total_increasing
        state: >
          {% set c = [
            'sensor.heatpump_electrical_energy_total_lts_v3',
            'sensor.heatpump_electrical_energy_total_lts_3',
            'sensor.heatpump_electrical_energy_total_lts_2',
            'sensor.heatpump_electrical_energy_total_lts',
            'sensor.heatpump_electrical_energy_total'
          ] %}
          {% for e in c %}
            {% set v = states(e) %}
            {% if v not in ['unknown','unavailable','', none] %}
              {{ v|float(0)|round(2) }}
              {% break %}
            {% endif %}
          {% endfor %}
          {% if c | map('states') | list | select('in', ['unknown','unavailable','', none]) | list | length == c|length %}
            {{ states('sensor.heatpump_electrical_energy_total_lts_src')|float(0)|round(2) }}
          {% endif %}

      - name: "Heatpump Heat Energy Total LTS"
        unique_id: heatpump_heat_energy_total_lts_alias_fallback
        unit_of_measurement: "kWh"
        device_class: energy
        state_class: total_increasing
        state: >
          {% set c = [
            'sensor.heatpump_heat_energy_total_lts_v3',
            'sensor.heatpump_heat_energy_total_lts_3',
            'sensor.heatpump_heat_energy_total_lts_2',
            'sensor.heatpump_heat_energy_total_lts',
            'sensor.heatpump_heat_energy_total'
          ] %}
          {% for e in c %}
            {% set v = states(e) %}
            {% if v not in ['unknown','unavailable','', none] %}
              {{ v|float(0)|round(2) }}
              {% break %}
            {% endif %}
          {% endfor %}
          {% if c | map('states') | list | select('in', ['unknown','unavailable','', none]) | list | length == c|length %}
            {{ states('sensor.heatpump_heat_energy_total_lts_src')|float(0)|round(2) }}
          {% endif %}